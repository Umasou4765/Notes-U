<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>Home - Notes-U</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* (UI unchanged) */
        :root {--light-bg:#f8f8f8;--light-text:#333;--light-label:#666;--light-input-bg:#fff;--light-input-border:rgba(55,53,47,0.16);--light-input-placeholder:rgba(55,53,47,0.4);--light-file-area-bg:#fff;--light-file-area-border:rgba(55,53,47,0.16);--light-file-area-hover-bg:rgba(55,53,47,0.03);--light-file-area-dragover-bg:rgba(55,53,47,0.08);--light-icon-color:rgba(55,53,47,0.3);--light-file-text:rgba(55,53,47,0.6);--light-sm-text:rgba(55,53,47,0.4);--light-file-name:#333;--light-error-color:#dc3545;--light-container-bg:#fff;--light-container-shadow:0 4px 12px rgba(0,0,0,.05);--light-accent-color:#007bff;--light-accent-hover:#0056b3;--light-button-secondary-bg:#e9ecef;--light-button-secondary-hover-bg:#dae0e5;--light-separator-color:#bbb;}
        body.dark {--light-bg:#1a1a1a;--light-text:rgba(255,255,255,0.9);--light-label:rgba(255,255,255,0.6);--light-input-bg:#252525;--light-input-border:rgba(255,255,255,0.1);--light-input-placeholder:rgba(255,255,255,0.4);--light-file-area-bg:#252525;--light-file-area-border:rgba(255,255,255,0.1);--light-file-area-hover-bg:#3a3a3a;--light-file-area-dragover-bg:#3a3a3a;--light-icon-color:rgba(255,255,255,0.3);--light-file-text:rgba(255,255,255,0.6);--light-sm-text:rgba(255,255,255,0.4);--light-file-name:rgba(255,255,255,0.9);--light-error-color:#ff6b6b;--light-container-bg:#252525;--light-container-shadow:0 4px 12px rgba(255,255,255,0.02);--light-accent-color:#64b5f6;--light-accent-hover:#90caf9;--light-button-secondary-bg:#3a3a3a;--light-button-secondary-hover-bg:#4a4a4a;--light-separator-color:#666;}
        body{font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;margin:0;background-color:var(--light-bg);color:var(--light-text);transition:background-color .3s,color .3s;display:flex;flex-direction:column;min-height:100vh;}
        header{background-color:var(--light-container-bg);padding:15px 30px;box-shadow:0 2px 4px var(--light-container-shadow);display:flex;justify-content:space-between;align-items:center;transition:background-color .3s,box-shadow .3s;position:sticky;top:0;z-index:1000;}
        header .logo{font-size:1.8em;font-weight:700;color:var(--light-text);text-decoration:none;display:flex;justify-content:center;align-items:center;height:40px;width:40px;border:2px solid var(--light-text);border-radius:6px;transition:border-color .3s,color .3s;}
        .header-actions{display:flex;align-items:center;gap:15px;}
        .header-actions a.button,.header-actions button{padding:8px 15px;border:none;border-radius:6px;cursor:pointer;font-size:.9em;font-weight:500;text-decoration:none;display:inline-flex;align-items:center;justify-content:center;transition:background-color .2s,color .2s,box-shadow .2s;}
        .upload-button{background-color:var(--light-accent-color);color:#fff;}
        .upload-button:hover{background-color:var(--light-accent-hover);}
        .logout-button{background-color:var(--light-button-secondary-bg);color:var(--light-text);}
        .logout-button:hover{background-color:var(--light-button-secondary-hover-bg);}
        main{flex-grow:1;padding:30px;display:grid;grid-template-columns:320px 1fr;gap:30px;max-width:1400px;margin:30px auto;}
        .sidebar{background-color:var(--light-container-bg);border-radius:8px;padding:25px;box-shadow:var(--light-container-shadow);transition:background-color .3s,box-shadow .3s;overflow-y:auto;max-height:calc(100vh - 120px);}
        .sidebar h2{font-size:1.5em;font-weight:600;margin:0 0 20px;color:var(--light-text);}
        .category-list{list-style:none;padding:0;margin:0;}
        .category-list li{margin-bottom:6px;}
        .category-list a{display:block;padding:10px 12px;text-decoration:none;color:var(--light-label);background:transparent;border-radius:4px;transition:background-color .2s,color .2s;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
        .category-list a:hover,.category-list a.active{background-color:var(--light-button-secondary-bg);color:var(--light-text);}
        .category-semester-separator{font-size:.85em;font-weight:600;color:var(--light-separator-color);margin:15px 0 10px;padding-left:12px;text-transform:uppercase;letter-spacing:.5px;}
        .content-area{background-color:var(--light-container-bg);border-radius:8px;padding:25px;box-shadow:var(--light-container-shadow);transition:background-color .3s,box-shadow .3s;}
        .content-area h2{font-size:1.8em;font-weight:700;margin:0 0 25px;color:var(--light-text);}
        .search-bar{margin-bottom:20px;position:relative;}
        .search-bar input{width:100%;padding:10px 15px 10px 40px;border:1px solid var(--light-input-border);border-radius:6px;background-color:var(--light-input-bg);color:var(--light-text);font-size:1em;transition:border-color .2s,box-shadow .2s,background-color .2s;}
        .search-bar input::placeholder{color:var(--light-input-placeholder);}
        .search-bar input:focus{outline:none;border-color:var(--light-accent-color);box-shadow:0 0 0 1px var(--light-accent-color);}
        .search-bar .search-icon{position:absolute;left:12px;top:50%;transform:translateY(-50%);color:var(--light-icon-color);pointer-events:none;width:20px;height:20px;}
        .note-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px;}
        .note-card{background-color:var(--light-input-bg);border:1px solid var(--light-input-border);border-radius:8px;padding:20px;box-shadow:0 2px 8px rgba(0,0,0,0.03);transition:transform .2s,box-shadow .2s,background-color .2s,border-color .2s;}
        .note-card:hover{transform:translateY(-3px);box-shadow:0 4px 12px rgba(0,0,0,0.06);}
        .note-card h3{font-size:1.2em;font-weight:600;margin:0 0 10px;color:var(--light-text);}
        .note-card p{font-size:.9em;color:var(--light-label);line-height:1.5;margin:0 0 15px;}
        .category-tag{display:inline-block;background-color:var(--light-button-secondary-bg);color:var(--light-label);font-size:.8em;padding:5px 10px;border-radius:4px;margin:0 8px 8px 0;}
        .note-actions a{display:inline-block;margin-right:15px;color:var(--light-accent-color);text-decoration:none;font-size:.9em;font-weight:500;transition:color .2s;}
        .note-actions a:hover{color:var(--light-accent-hover);text-decoration:underline;}
        footer{padding:20px;text-align:center;font-size:.9em;color:var(--light-label);margin-top:auto;border-top:1px solid var(--light-input-border);transition:border-color .3s,color .3s;}
        @media (max-width:768px){main{grid-template-columns:1fr;padding:20px;margin:20px auto;}header{padding:10px 20px;flex-direction:column;gap:10px;}.header-actions{width:100%;justify-content:center;}.sidebar,.content-area{padding:20px;}.note-grid{grid-template-columns:1fr;}.sidebar{max-height:400px;}}
    </style>
</head>
<body>
    <header>
        <a href="/" class="logo" aria-label="Note-U Home"><span>U</span></a>
        <div class="header-actions">
            <a href="upload.html" class="button upload-button" id="upload-note-btn">Upload Note</a>
            <button class="logout-button" id="logout-btn">Log Out</button>
        </div>
    </header>

    <main>
        <aside class="sidebar">
            <h2>Academic Categories</h2>
            <ul class="category-list">
                <li><a href="#" class="active" data-category="all">All Notes</a></li>
                <li class="category-semester-separator">--- Year 1 Semester 1 ---</li>
                <li><a href="#" data-category="AMCS1013">AMCS1013 - Problem Solving and Programming</a></li>
                <li><a href="#" data-category="AMCS1113">AMCS1113 - Computer Architecture</a></li>
                <li><a href="#" data-category="AMIT1303">AMIT1303 - Introduction to Interface Design</a></li>
                <li><a href="#" data-category="AMMS1623">AMMS1623 - Calculus and Algebra</a></li>
                <li><a href="#" data-category="AJEL1713">AJEL1713 - English for Tertiary Studies</a></li>
                <li><a href="#" data-category="MPU2302">MPU-2302 - Integrity and Anti-Corruption</a></li>
                <li><a href="#" data-category="MPU2123">MPU-2123 - Penghayatan Etika dan Peradaban</a></li>
                <li class="category-semester-separator">--- Year 1 Semester 2 ---</li>
                <li><a href="#" data-category="AMCS1043">AMCS1043 - Database Development and Applications</a></li>
                <li><a href="#" data-category="AMCS1034">AMCS1034 - Software Development Fundamentals</a></li>
                <li><a href="#" data-category="AMMS2613">AMMS2613 - Probability and Statistics</a></li>
                <li class="category-semester-separator">--- Year 1 Semester 3 ---</li>
                <li><a href="#" data-category="AMIT2034">AMIT2034 - Fundamentals of Computer Networks</a></li>
                <li><a href="#" data-category="AMCS2204">AMCS2204 - Object-Oriented Programming Techniques</a></li>
                <li><a href="#" data-category="AMCS2093">AMCS2093 - Operating Systems</a></li>
                <li><a href="#" data-category="AMIS1013">AMIS1013 - Systems Analysis and Design</a></li>
                <li><a href="#" data-category="AMMS2603">AMMS2603 - Discrete Mathematics</a></li>
                <li><a href="#" data-category="AJEL1723">AJEL1723 - Academic English</a></li>
                <li class="category-semester-separator">--- Year 2 Semester 1 ---</li>
                <li><a href="#" data-category="AMCS2034">AMCS2034 - Introduction to Data Structures and Algorithms</a></li>
                <li><a href="#" data-category="AMCS2123">AMCS2123 - Systems and Programming Concepts</a></li>
                <li><a href="#" data-category="AMCS2104">AMCS2104 - Fundamentals of Artificial Intelligence</a></li>
                <li><a href="#" data-category="AMIT3353">AMIT3353 - Mobile Application Development</a></li>
                <li><a href="#" data-category="AMIS1012">AMIS1012 - Ethics in Computing</a></li>
                <li class="category-semester-separator">--- Year 2 Semester 2 ---</li>
                <li><a href="#" data-category="AMCS2094">AMCS2094 - Mini Project</a></li>
                <li><a href="#" data-category="AMCS2103">AMCS2103 - Parallel and Distributed Computing</a></li>
                <li><a href="#" data-category="AMIS1003">AMIS1003 - Introduction to Cybersecurity</a></li>
                <li class="category-semester-separator">--- Year 2 Semester 3 ---</li>
                <li><a href="#" data-category="AMIT320A">AMIT320A - Industrial Training</a></li>
            </ul>
        </aside>

        <section class="content-area">
            <h2>Your Notes & Resources</h2>
            <div class="search-bar">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="search-icon">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                </svg>
                <input type="text" id="searchInput" placeholder="Search notes by title, description, or subject...">
            </div>
            <div id="notes-container" class="note-grid">
                <div class="note-card" data-category="placeholder-note">
                    <h3>No Notes Found</h3>
                    <p>It looks like there are no notes available for this category yet, or your notes haven't been loaded. Upload some notes to get started!</p>
                    <div class="tags">
                        <span class="category-tag">Information</span>
                        <span class="category-tag">Get Started</span>
                    </div>
                    <div class="note-actions">
                        <a href="upload.html">Upload Now</a>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>&copy; 2025 Note-U. All rights reserved.</footer>

    <script type="module">
        import { onAuth, logout, fetchMyNotes } from './firebase-init.js';

        function setTheme(theme){
            document.body.classList.remove('light','dark');
            document.body.classList.add(theme);
            localStorage.setItem('theme',theme);
        }

        const storedTheme = localStorage.getItem('theme');
        if(storedTheme) setTheme(storedTheme);
        else setTheme(window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark':'light');

        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change',e=>{
          if(!localStorage.getItem('theme')) setTheme(e.matches?'dark':'light');
        });
        window.addEventListener('storage',e=>{
          if(e.key==='theme' && e.newValue) setTheme(e.newValue);
        });

        const logoutButton = document.getElementById('logout-btn');
        const categoryLinks = document.querySelectorAll('.category-list a');
        const notesContainer = document.getElementById('notes-container');
        const searchInput = document.getElementById('searchInput');
        let allNotesData = [];

        logoutButton.addEventListener('click', async ()=>{
            await logout();
            location.href='auth.html?mode=login';
        });

        function escapeHtml(str){
          return str.replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c]));
        }

        function renderNotes(list){
          notesContainer.innerHTML='';
          if(!list.length){
            notesContainer.innerHTML=`
              <div class="note-card" data-category="placeholder-note">
                <h3>No Notes Found</h3>
                <p>It looks like there are no notes available for this category yet. Upload some notes to get started!</p>
                <div class="tags">
                  <span class="category-tag">Information</span>
                  <span class="category-tag">Get Started</span>
                </div>
                <div class="note-actions"><a href="upload.html">Upload Now</a></div>
              </div>`;
            return;
          }
          list.forEach(note=>{
            const prettyType = (note.notes_type||'').replace(/_/g,' ').replace(/\b\w/g,c=>c.toUpperCase());
            const card = document.createElement('div');
            card.className='note-card';
            card.dataset.category = note.subject_code;
            card.innerHTML=`
              <h3>${escapeHtml(note.title)}</h3>
              <p>${escapeHtml(note.description || 'No description provided.')}</p>
              <div class="tags">
                <span class="category-tag">${escapeHtml(note.academic_year.replace('year','Year '))}</span>
                <span class="category-tag">${escapeHtml(note.semester.replace('semester','Semester '))}</span>
                <span class="category-tag">${escapeHtml(note.subject_code)}</span>
                <span class="category-tag">${escapeHtml(prettyType)}</span>
              </div>
              <div class="note-actions">
                <a href="${note.file_url}" target="_blank" rel="noopener">View / Download</a>
              </div>`;
            notesContainer.appendChild(card);
          });
        }

        function applyFilters(){
          const active = document.querySelector('.category-list a.active');
          const cat = active ? active.dataset.category : 'all';
          const term = (searchInput.value||'').toLowerCase();
          const filtered = allNotesData.filter(n=>{
            const matchCat = cat==='all' || n.subject_code===cat;
            const hay = (n.title+' '+(n.description||'')+' '+n.subject_code).toLowerCase();
            const matchSearch = !term || hay.includes(term);
            return matchCat && matchSearch;
          });
          renderNotes(filtered);
        }

        categoryLinks.forEach(a=>{
          a.addEventListener('click',e=>{
            e.preventDefault();
            categoryLinks.forEach(l=>l.classList.remove('active'));
            a.classList.add('active');
            applyFilters();
          });
        });
        searchInput.addEventListener('input', applyFilters);

        async function loadNotes(){
          try {
            allNotesData = await fetchMyNotes();
            applyFilters();
          } catch(e){
            notesContainer.innerHTML=`
              <div class="note-card">
                <h3>Error</h3>
                <p>${escapeHtml(e.message||'Failed to load notes')}</p>
                <div class="note-actions"><a href="#" onclick="location.reload();return false;">Reload</a></div>
              </div>`;
          }
        }

        onAuth(user=>{
          if(!user) location.href='auth.html?mode=login';
          else loadNotes();
        });
    </script>
</body>
</html>