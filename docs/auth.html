<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>Auth - Notes-U</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* (UI unchanged) */
        :root { --color-bg-light:#f8f8f8;--color-text-primary-light:#333;--color-text-secondary-light:#666;--color-border-light:rgba(55,53,47,0.1);--color-input-bg-light:#fff;--color-input-hover-light:rgba(55,53,47,0.03);--color-input-border-hover-light:rgba(55,53,47,0.2);--color-separator-line-light:#ddd;--color-link-light:#007bff;--color-link-hover-light:#0056b3;--color-card-bg-light:#fff;--color-shadow-light:rgba(0,0,0,0.05);--color-bg-dark:#121212;--color-text-primary-dark:rgba(255,255,255,0.9);--color-text-secondary-dark:rgba(255,255,255,0.6);--color-border-dark:rgba(255,255,255,0.1);--color-input-bg-dark:#252525;--color-input-hover-dark:#333;--color-input-border-hover-dark:rgba(255,255,255,0.2);--color-separator-line-dark:#444;--color-link-dark:#64b5f6;--color-link-hover-dark:#90caf9;--color-card-bg-dark:#1a1a1a;--color-shadow-dark:rgba(255,255,255,0.02);--color-accent-blue:#007bff;--color-accent-blue-hover:#0056b3;--color-icon-light:#333;--color-icon-dark:#fff;}
        body{font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;display:flex;justify-content:center;align-items:center;min-height:100vh;margin:0;background-color:var(--color-bg-light);color:var(--color-text-primary-light);flex-direction:column;box-sizing:border-box;overflow-x:hidden;width:100%;transition:background-color .3s,color .3s;padding:20px;}
        body.dark{background-color:var(--color-bg-dark);color:var(--color-text-primary-dark);}
        .container{text-align:center;padding:32px;max-width:420px;width:100%;box-sizing:border-box;background-color:var(--color-card-bg-light);border-radius:12px;box-shadow:0 6px 20px var(--color-shadow-light);transition:background-color .3s,box-shadow .3s;}
        body.dark .container{background-color:var(--color-card-bg-dark);box-shadow:0 6px 20px var(--color-shadow-dark);}
        .logo{font-size:2.8em;font-weight:700;margin-bottom:24px;color:var(--color-text-primary-light);display:flex;justify-content:center;align-items:center;height:60px;width:60px;border:2px solid var(--color-text-primary-light);border-radius:8px;box-sizing:border-box;margin-left:auto;margin-right:auto;transition:border-color .3s,color .3s;}
        body.dark .logo{color:var(--color-text-primary-dark);border-color:var(--color-text-primary-dark);}
        h1{font-size:2em;font-weight:700;margin-bottom:8px;color:var(--color-text-primary-light);line-height:1.3;transition:color .3s;}
        body.dark h1{color:var(--color-text-primary-dark);}
        p{font-size:1em;color:var(--color-text-secondary-light);margin-bottom:32px;transition:color .3s;}
        body.dark p{color:var(--color-text-secondary-dark);}
        .form-group{margin-bottom:20px;text-align:left;}
        .form-group label{display:block;margin-bottom:8px;font-weight:500;color:var(--color-text-primary-light);transition:color .3s;}
        body.dark .form-group label{color:var(--color-text-primary-dark);}
        .form-group input{width:100%;padding:12px 15px;border:1px solid var(--color-border-light);border-radius:8px;font-size:1em;background-color:var(--color-input-bg-light);color:var(--color-text-primary-light);box-sizing:border-box;transition:border-color .2s,background-color .2s,box-shadow .2s;}
        .form-group input:focus{outline:none;border-color:var(--color-accent-blue);box-shadow:0 0 0 3px rgba(0,123,255,.25);}
        body.dark .form-group input{background-color:var(--color-input-bg-dark);color:var(--color-text-primary-dark);border-color:var(--color-border-dark);}
        body.dark .form-group input:focus{border-color:var(--color-link-dark);box-shadow:0 0 0 3px rgba(100,181,246,.25);}
        .submit-button{width:100%;padding:14px 20px;border:none;border-radius:8px;background-color:var(--color-accent-blue);color:#fff;font-size:1.05em;font-weight:600;cursor:pointer;transition:background-color .2s,box-shadow .2s;box-shadow:0 1px 3px rgba(0,0,0,.05);}
        .submit-button:hover{background-color:var(--color-accent-blue-hover);box-shadow:0 2px 6px rgba(0,0,0,.08);}
        body.dark .submit-button{background-color:var(--color-accent-blue);}
        body.dark .submit-button:hover{background-color:var(--color-accent-blue-hover);box-shadow:0 2px 6px rgba(255,255,255,.05);}
        .switch-link{font-size:.95em;color:var(--color-link-light);text-decoration:none;margin-top:24px;display:block;transition:color .2s,text-decoration .2s;}
        .switch-link:hover{text-decoration:underline;color:var(--color-link-hover-light);}
        body.dark .switch-link{color:var(--color-link-dark);}
        body.dark .switch-link:hover{color:var(--color-link-hover-dark);}
        .auth-form{display:none;}
        .auth-form.active{display:block;}
        @media(min-width:768px){.container{max-width:480px;padding:48px;border-radius:16px;box-shadow:0 8px 30px var(--color-shadow-light);}body.dark .container{box-shadow:0 8px 30px var(--color-shadow-dark);} .logo{font-size:3.5em;height:70px;width:70px;margin-bottom:32px;}h1{font-size:2.5em;}p{font-size:1.1em;}.submit-button{padding:16px 25px;font-size:1.15em;}}
    </style>
</head>
<body>
    <div class="container">
        <div class="logo" aria-label="Note-U Logo">
            <span>U</span>
        </div>
        <h1 id="auth-title"></h1>
        <p id="auth-description"></p>

        <div id="login-form" class="auth-form">
            <form autocomplete="off">
                <div class="form-group">
                    <label for="login-username">Username</label>
                    <input type="text" id="login-username" required placeholder="Enter your username">
                </div>
                <div class="form-group">
                    <label for="login-access-code">Access Code</label>
                    <input type="password" id="login-access-code" required placeholder="Enter your access code">
                </div>
                <button type="submit" class="submit-button" id="login-btn">Log In</button>
            </form>
            <a href="auth.html?mode=signup" class="switch-link">Don't have an account? Create one now</a>
        </div>

        <div id="signup-form" class="auth-form">
            <form autocomplete="off">
                <div class="form-group">
                    <label for="signup-username">Username</label>
                    <input type="text" id="signup-username" required placeholder="Choose a username">
                </div>
                <div class="form-group">
                    <label for="signup-access-code">Create Access Code</label>
                    <input type="password" id="signup-access-code" required placeholder="Create an access code">
                </div>
                <div class="form-group">
                    <label for="signup-confirm-access-code">Confirm Access Code</label>
                    <input type="password" id="signup-confirm-access-code" required placeholder="Confirm your access code">
                </div>
                <button type="submit" class="submit-button" id="signup-btn">Sign Up</button>
            </form>
            <a href="auth.html?mode=login" class="switch-link">Already have an account? Log In instead</a>
        </div>
    </div>

    <script type="module">
        import { signupWithUsername, loginWithUsername, onAuth } from './firebase-init.js';

        function setTheme(isDark){ if(isDark) document.body.classList.add("dark"); else document.body.classList.remove("dark"); }
        const storedTheme = localStorage.getItem("theme");
        if(storedTheme==="dark") setTheme(true); else if(storedTheme==="light") setTheme(false); else setTheme(window.matchMedia('(prefers-color-scheme: dark)').matches);

        const params = new URLSearchParams(location.search);
        const mode = params.get('mode') === 'signup' ? 'signup' : 'login';
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const authTitle = document.getElementById('auth-title');
        const authDesc = document.getElementById('auth-description');

        function applyMode(m){
            if(m==='signup'){
                signupForm.classList.add('active');
                loginForm.classList.remove('active');
                authTitle.textContent='Sign Up for Note-U';
                authDesc.textContent='Create your account to access shared academic notes.';
            } else {
                loginForm.classList.add('active');
                signupForm.classList.remove('active');
                authTitle.textContent='Log In to Note-U';
                authDesc.textContent='Access your shared academic notes with your account.';
            }
        }
        applyMode(mode);

        loginForm.querySelector('form').addEventListener('submit', async e=>{
            e.preventDefault();
            const u = document.getElementById('login-username').value.trim();
            const p = document.getElementById('login-access-code').value;
            if(!u||!p){ alert('Fill all fields'); return; }
            try {
                await loginWithUsername(u,p);
                alert('Login successful');
                location.href='home.html';
            } catch(err){ alert(err.message||'Login failed'); }
        });

        signupForm.querySelector('form').addEventListener('submit', async e=>{
            e.preventDefault();
            const u = document.getElementById('signup-username').value.trim();
            const p = document.getElementById('signup-access-code').value;
            const c = document.getElementById('signup-confirm-access-code').value;
            if(!u||!p){ alert('Fill all fields'); return; }
            if(p!==c){ alert('Access codes do not match'); return; }
            try {
                await signupWithUsername(u,p);
                alert('Account created. Please log in.');
                location.href='auth.html?mode=login';
            } catch(err){ alert(err.message||'Signup failed'); }
        });

        onAuth(user=>{
            if(user){
                // already logged in optionally redirect
                // location.href='home.html';
            }
        });

        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e=>{
            if(!localStorage.getItem("theme")) setTheme(e.matches);
        });
        window.addEventListener('storage', e=>{
            if(e.key==='theme') setTheme(e.newValue==='dark');
        });
    </script>
</body>
</html>